{
    "contents" : "\nrequire(fOptions)\nrequire(xts)\nrequire(dplyr)\nrequire(ggplot2)\nrequire(scales)\n\n# Final data preparations\nload('rubswap.RData')\nrub3m = rubmrtk[, c('USD.RUB', 'swap3m_perc', 'iv3m')]\nnames(rub3m) = c('rub', 'swap', 'iv')\nrub3m$iv = rub3m$iv/100\n\n#\n# 3m options prices every day\n# \nrub3m$call = (as.data.frame(rub3m) %>% mutate(call = GBSOption('c', rub, rub, 90/365, swap, 0, iv)@price))[, c('call')]\nrub3m$put  = (as.data.frame(rub3m) %>% mutate(put = GBSOption('p', rub, rub, 90/365, swap, 0, iv)@price))[, c('put')]\n#autoplot(rub3m$call)\n\n\n# Option price as base asset ratio\nlocal({\n  \n  callperc = rub3m$call / rub3m$rub\n  hist(callperc, breaks=30, main = 'Call/Usd distribution')\n  cat('Average call price: ', percent(mean(callperc)))\n  \n})\n\n\n# What if we do not hedge?\n\nlocal({\n  \n  usd_diff = lag(diff(rub3m$rub, 90*5/7), k=-90*5/7)\n  usd_roc = usd_diff /  rub3m$rub %>% na.omit\n  autoplot(usd_roc)\n  #hist(usd_diff, breaks=30)\n  cat('Average 90-days USD price change: ', format(mean(usd_roc, na.rm = T), digits=4))\n  \n})\n\n# Does the rise of USD covers call premium?\n\n  usd_up = usd_diff; usd_up[usd_up<0, ]=0\n  \n  call_result = (usd_up - rub3m$call) / rub3m$rub\n  data.frame(\n    Period = c('All', '2010 - 2013', '2014+'), \n    Result = format(c(mean(call_result, na.rm = T), \n               mean(call_result['2010/2013']), \n               mean(call_result['2014'])\n               ), digits=2)\n    )\n  \n\n  # If USD rises, average coverage\n  mean(call_result[call_result>0,])\n  \n  # In all cases, average coverage\n  mean(na.omit(call_result))\n\n\n\nusd_down = usd_diff; usd_down[usd_down>0, ]=0\nmean(-usd_diff[usd_diff<0, ]/rub3m$rub)\nmean((-usd_diff[usd_diff<0, ] - rub3m$call)/rub3m$rub, na.rm = T)\n\n # Price change to call price\nrub3m$difftocall = rub3m$diff / rub3m$call \n\nabsDiffToCall = abs(rub3m$diff) / rub3m$call\nsummary(absDiffToCall)\nautoplot(absDiffToCall)\n\n autoplot(\n   merge(call_result, -usd_diff/rub3m$rub), facets=NULL\n  )\n\nmean(call_result-usd_diff/rub3m$rub, na.rm=T)\n\n\n\n",
    "created" : 1441290325294.000,
    "dirty" : false,
    "encoding" : "CP1251",
    "folds" : "",
    "hash" : "4042721369",
    "id" : "E377B485",
    "lastKnownWriteTime" : 1442324167,
    "path" : "~/RBackup/HedgeBacktest/callbacktest.R",
    "project_path" : "callbacktest.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}