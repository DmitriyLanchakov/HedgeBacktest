{
    "contents" : "\nrequire(fOptions)\nrequire(xts)\nrequire(dplyr)\nrequire(ggplot2)\n\n# Final data preparations\nrub3m = rubmrtk[, c('USD.RUB', 'swap3m_perc', 'iv3m')]\nnames(rub3m) = c('rub', 'swap', 'iv')\nrub3m$iv = rub3m$iv/100\n\n#\n# 3m options prices every day\n# \nrub3m$call = (as.data.frame(rub3m) %>% mutate(call = GBSOption('c', rub, rub, 90/365, swap, 0, iv)@price))[, c('call')]\nrub3m$put  = (as.data.frame(rub3m) %>% mutate(put = GBSOption('p', rub, rub, 90/365, swap, 0, iv)@price))[, c('put')]\n#autoplot(rub3m$call)\n\n\n# Option price as base asset ratio\nrub3m$callperc = rub3m$call / rub3m$rub\nhist(rub3m$callperc, breaks=30)\nsummary(rub3m$callperc)\n\n\n# USD price change during hedge period\nrub3m$diff = lag(diff(rub3m$rub, 90*5/7), k=-90*5/7)\n\n  # Only risings\n  rub3m$diffup = rub3m$diff\n  rub3m$diffup[which(rub3m$diffup<0),]=0\n\n  # Only falling\n  rub3m$diff_down = rub3m$diff\n  rub3m$diff_down[which(rub3m$diff_down>0),]=0\n\nhead(rub3m)\ntail(rub3m)\n\nrub3m$difftocall = rub3m$diff / rub3m$call \n\nsummary(rub3m$calltodiff[which(rub3m$calltodiff>0),])\nsummary(rub3m$calltodiff[which(rub3m$calltodiff<0),])\n\nhist(rub3m$calltodiff, breaks = 100)\n\nsummary(rub3m$calltodiff)\n\n\n\n\n# Financial result at the start point\n# USD change minus option price\nrub3m$result = (lag(rub3m$rubup, k = -90*5/7) - rub3m$call) # result for option only\n \nrub3m$result1 = (lag(rub3m$absdiff, k = -90*5/7) - rub3m$call) # result for option and usd-fall\n\nautoplot(rub3m[,c('result', 'result1')], facet=NULL)\n\nhead(rub3m$resultperc)\ntail(rub3m$resultperc)\n\n#test\nrub3m$rollror = diff(rub3m$rub, k = 90*5/7)/rub3m$rub)\n\nrub3m$normal = diff(rub3m$rub)/rub3m$rub+1 \n\nautoplot(\n  cumprod(rub3m$normal[-1,] )\n  )\n#--=\n\n\nrub3m$resultperc = rub3m$result / rub3m$rub\nrub3m$rubupperc = rub3m$rubup / rub3m$rub\n\nrub3m$rubup[which(is.na( rub3m$rubup))] = 0\n\nautoplot(rub3m['2010/2013', c('rubupperc', 'resultperc')], geom='area')\n\nsummary(rub3m$resultperc['2010/2013'])\nhist(rub3m$resultperc['2010/2013'], breaks = 30)\n\nqqnorm(na.omit(rub3m$resultperc[,1]))\n\n\n",
    "created" : 1441290325294.000,
    "dirty" : false,
    "encoding" : "CP1251",
    "folds" : "",
    "hash" : "2008622551",
    "id" : "E377B485",
    "lastKnownWriteTime" : 1441897499,
    "path" : "~/RBackup/HedgeBacktest/callbacktest.R",
    "project_path" : "callbacktest.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}