cumprod(rub3m$normal)
)
rub3m$normal = diff(rub3m$rub)/rub3m$rub+1
diff(rub3m$rub)/rub3m$rub+1
View(rub3m)
rub3m$normal[1]
rub3m$normal[1]=0
cumprod(rub3m$normal, )
cumprod(rub3m$normal )
rub3m$normal[1]=1
cumprod(rub3m$normal )
autoplot(
cumprod(rub3m$normal )
)
autoplot(
cumprod(rub3m$normal[-1,] )
)
diff(rub3m$rub, k = 90*5/7)/rub3m$rub
autoplot(diff(rub3m$rub, k = 90*5/7)/rub3m$rub)
require(fOptions)
require(xts)
require(dplyr)
autoplot(rub3m$call)
require(ggplot)
require(ggplot2)
autoplot(rub3m$call)
rub3m$callperc = rub3m$call / rub3m$rub
autoplot(rub3m$callperc)
hist(rub3m$callperc)
hist(rub3m$callperc, breaks=30)
summary(rub3m$callperc)
rub3m[['absdiff']]
rub3m[['call']]
rub3m['call']
rub3m[, c('call')]
rub3m[, -c('call')]
rub3m[, c(-'call')]
rub3m[, !c('call')]
rub3m$calltodiff = rub3m$call / rub3m$diff
View(rub3m)
View(rub3m)
!is.na(rub3m$call)
rub3m$diff[which(!is.na(rub3m$call))]
rub3m$diff[which(!is.na(rub3m$call)),]
which(!is.na(rub3m$call))
rub3m$diff[which(!is.na(rub3m$call)),]
rub3m$diff
rub3m = rubmrtk[, c('USD.RUB', 'swap3m_perc', 'iv3m')]
View(rub3m)
names(rub3m) = c('rub', 'swap', 'iv')
rub3m$iv = rub3m$iv/100
rub3m$call = (as.data.frame(rub3m) %>% mutate(call = GBSOption('c', rub, rub, 90/365, swap, 0, iv)@price))[, c('call')]
autoplot(rub3m$call)
View(rub3m)
autoplot(rub3m$call)
autoplot(rub3m$call)
rub3m$callperc = rub3m$call / rub3m$rub
hist(rub3m$callperc, breaks=30)
View(rub3m)
rub3m$diff = diff(rub3m$rub, 90*5/7)
rub3m$calltodiff = rub3m$call / rub3m$diff
autoplot(rub3m$calltodiff)
View(rub3m)
rub3m$calltodiff = rub3m$call / lag(rub3m$diff, k=-90*5/7) #(lag(rub3m$rubup, k = -90*5/7) - rub3m$call)
autoplot(rub3m$calltodiff)
View(rub3m)
hist(rub3m$calltodiff)
hist(rub3m$calltodiff, breaks = 20)
hist(rub3m$calltodiff, breaks = 100)
hist(rub3m$calltodiff[which(rub3m$calltodiff>-50 & rub3m$calltodiff<50),], breaks = 100)
summary(rub3m$calltodiff)
hist(rub3m$calltodiff['2010/2013'], breaks = 100)
summary(rub3m$calltodiff['2010/2013'])
summary(rub3m$calltodiff)
rub3m$put  = (as.data.frame(rub3m) %>% mutate(put = GBSOption('p', rub, rub, 90/365, swap, 0, iv)@price))[, c('put')]
autoplot(rub3m$put)
hist(rub3m$callperc['2010/2013'], breaks=30)
summary(rub3m$callperc['2010/2013'])
hist(rub3m$callperc, breaks=30)
summary(rub3m$callperc)
hist(rub3m$callperc['2014/2015'], breaks=30)
summary(rub3m$callperc['2014/2015'])
View(rub3m)
rub3m$diff = lag(diff(rub3m$rub, 90*5/7), k=-90*5/7)
View(rub3m)
rub3m$diffup = diff(rub3m$rub, 90*5/7)
rub3m$diffup[which(rub3m$diffup<0),]=0
rub3m$diff_down = diff(rub3m$rub, 90*5/7)
rub3m$diff_down[which(rub3m$diff_down>0),]=0
View(rub3m)
rub3m$diffup = rub3m$diff
rub3m$diffup[which(rub3m$diffup<0),]=0
rub3m$diff_down = rub3m$diff
rub3m$diff_down[which(rub3m$diff_down>0),]=0
View(rub3m)
rub3m$calltodiff[which(rub3m$calltodiff>0),]
summary(rub3m$calltodiff[which(rub3m$calltodiff>0),])
summary(rub3m$calltodiff[which(rub3m$calltodiff<0),])
autoplot(rub3m$call
)
hist(rub3m$callperc, breaks=30)
summary(rub3m$callperc)
rub3m$diff = lag(diff(rub3m$rub, 90*5/7), k=-90*5/7)
rub3m$calltodiff = rub3m$call / rub3m$diff
summary(rub3m$calltodiff[which(rub3m$calltodiff>0),])
summary(rub3m$calltodiff[which(rub3m$calltodiff<0),])
head(rub3m)
tail(rub3m)
rub3m$diff = NA
rub3m$diff = lag(diff(rub3m$rub, 90*5/7), k=-90*5/7)
head(rub3m)
tail(rub3m)
rub3m$diffup = rub3m$diff
rub3m$diffup[which(rub3m$diffup<0),]=0
# Only falling
rub3m$diff_down = rub3m$diff
rub3m$diff_down[which(rub3m$diff_down>0),]=0
head(rub3m)
tail(rub3m)
rub3m$calltodiff = rub3m$call / rub3m$diff
summary(rub3m$calltodiff[which(rub3m$calltodiff>0),])
summary(rub3m$calltodiff[which(rub3m$calltodiff<0),])
autoplot(rub3m$iv)
autoplot(rub3m$swap)
autoplot(rub3m$rub)
autoplot(rub3m$diff)
rub3m$difftocall = rub3m$diff / rub3m$call
autoplot(rub3m$difftocall)
summary(rub3m$difftocall)
summary(abs(rub3m$difftocall))
require(fOptions)
require(xts)
require(dplyr)
require(ggplot2)
autoplot(rub3m$difftocall)
summary(rub3m$difftocall)
summary(abs(rub3m$difftocall))
hist(abs(rub3m$difftocall))
hist((rub3m$difftocall))
hist((rub3m$difftocall['2010/2013']))
summary((rub3m$difftocall['2010/2013']))
summary(abs(rub3m$difftocall['2010/2013']))
hist(abs(rub3m$difftocall['2010/2013']))
hist(abs(rub3m$diff['2010/2013']))
summary((rub3m$diff['2010/2013']))
rub3m$roc = rub3m$diff / rub3m$rub
summary((rub3m$roc['2010/2013']))
hist((rub3m$roc['2010/2013']))
summary(rub3m$difftocall)
summary(rub3m$difftocall)$difftocall
summary(rub3m$difftocall)[difftocall]
summary(rub3m$difftocall)['difftocall']
summary(rub3m$difftocall)[[1]]
summary(rub3m$difftocall)[1]
summary(rub3m$difftocall)[1,1]
summary(rub3m$difftocall)[0]
summary(rub3m$difftocall)[7:13]
summary(rub3m$difftocall)[[7:13]]
attributes(summary(rub3m$difftocall))
str(summary(rub3m$difftocall))
summary(rub3m$difftocall)["  difftocall"]
summary(rub3m$difftocall)[["  difftocall"]]
summary(rub3m$difftocall)["difftocall"]
summary(rub3m$difftocall)[["difftocall"]]
summary(rub3m$difftocall, digits=4)
as.data.frame(summary(rub3m$difftocall, digits=4))
as.list(summary(rub3m$difftocall, digits=4))
as.data.frame(summary(rub3m$difftocall, digits=4))
as.data.frame(summary(rub3m$difftocall, digits=4)[7:13])
as.data.frame(DiffToCall = summary(rub3m$difftocall, digits=4)[7:13])
as.data.frame(summary(rub3m$difftocall, digits=4)[7:13])
as.data.frame(rub3m$difftocall)
summary(as.data.frame(rub3m$difftocall), digits=4)
summary(as.data.frame(rub3m$difftocall), digits=4)
summary(as.data.frame(DiffToCall = rub3m$difftocall), digits=4)
summary(as.data.frame(rub3m$difftocall), digits=4)
absDiffToCall = abs(rub3m$diff) / rub3m$call
summary(absDiffToCall)
autoplot(absDiffToCall)
autoplot(rub3m$difftocall)
autoplot(merge(absDiffToCall, rub3m$difftocall) )
autoplot(merge(absDiffToCall, rub3m$difftocall), facets=NULL )
RollRor = - rub3m$diff / rub3m$rub
autoplot(RollRor)
head(RollRor)
tail(RollRor)
autoplot(cumprod(RollRor+1))
autoplot(cumsum(RollRor+1))
summary(RollRor)
hist(RollRor)
hist(RollRor, breaks=20)
hist(RollRor, breaks=100)
hist(RollRor, breaks=100, title='xxx')
hist(RollRor, breaks=100, title(main='xxx'))
hist(RollRor, breaks=100, aes(title(main='xxx')))
hist(RollRor, breaks=100, main='xxx')
hist(RollRor, breaks=100, main='xxx', col='red')
hist(RollRor, breaks=100, main='xxx', col=rgb(0,100, 100, maxColorValue = 255))
hist(RollRor, breaks=100, main='xxx', col=rgb(100,100, 0, maxColorValue = 255))
hist(RollRor, breaks=100, main='xxx', col=rgb(100,0, 0, maxColorValue = 255))
hist(RollRor, breaks=100, main='xxx', col=rgb(100,0, 0, maxColorValue = 255), border=NULL)
hist(RollRor, breaks=100, main='xxx', col=rgb(100,0, 0), border=NULL)
hist(RollRor, breaks=100, main='xxx', col=rgb(100,0, 0,  maxColorValue = 256), border=NULL)
hist(RollRor, breaks=100, main='xxx', col=rgb(198,32, 0,  maxColorValue = 256), border=NULL)
hist(RollRor, breaks=100, main='xxx', col=rgb(171,173, 175, maxColorValue = 256), border=NULL)
autoplot(RollRor)
autoplot(absDiffToCall)
autoplot(-absDiffToCall)
summary(rub3m$callperc)
require(fOptions)
require(xts)
require(dplyr)
require(ggplot2)
View(rub3m)
ls()
rm(ls())
rm(c(ls()))
rm(list=ls())
data(rubswap)
load('rubswap.RData')
View(rubswap)
require(quantmod, quietly = T)
library(dplyr, quietly = T)
require(foreach)
require(tidyr)
require(ggplot2)
options(scipen = 999)
allUSDRUB = NULL
foreach (i = 1:15) %do% {
getFX('USD/RUB', from = paste(2000 + i, '-01-01', sep=''), to = paste(2000 + i + 1, '-01-01', sep=''),)
if(is.null(allUSDRUB)) allUSDRUB=USDRUB else allUSDRUB=c(allUSDRUB, USDRUB)
}
allUSDRUB = allUSDRUB[which(ROC(allUSDRUB$USD.RUB)!=0), ]
View(allUSDRUB)
rm(USDRUB)
iv = read.csv('usdrub_iv.csv', sep=';')
iv = xts(x = iv[,2:4], order.by = as.Date(as.character(iv[,1]), format='%d.%m.%Y'))
names(iv) = c('iv1m', 'iv3m', 'iv1y')
swap3m = read.csv(file='swap3m.csv'), sep = ';')
swap3m = read.csv(file='swap3m.csv', sep = ';')
View(swap3m)
View(swap3m)
View(swap3m)
names(swap3m) = c('Date', 'swap3m')
swap3m$Date = as.Date(swap3m$Date, '%d.%m.%Y')
swap1y = read.csv(file='swap1y.csv', sep = ';')
names(swap1y) = c('Date', 'swap1y')
swap1y$Date = as.Date(swap1y$Date, '%d.%m.%Y')
swaps = full_join(swap1y, swap3m, by = 'Date')
swaps = as.xts(x = swaps[,2:3,drop=F], order.by = swaps$Date) %>% na.locf
rubswap = cbind.xts(allUSDRUB, swaps, all = c(F,T)) %>% na.locf %>% na.omit
rubmrtk = cbind.xts(rubswap, iv, all = c(T,T)) %>% na.omit
rubmrtk$swap3m_perc = (as.data.frame(rubmrtk) %>% mutate(swp3 = swap3m/1000000/USD.RUB*90) %>% select(swp3))[[1]]
rubmrtk$swap1y_perc = (as.data.frame(rubmrtk) %>% mutate(swp1 = swap1y/1000000/USD.RUB*365) %>% select(swp1))[[1]]
autoplot.zoo(window(rubswap[,4:5], start = '2006-01-01'), facets = NULL)
autoplot(window(rubswap[,4:5], start = '2006-01-01'), facets = NULL)
View(rubswap)
View(rubswap)
View(rubmrtk)
save(rubmrtk, file = 'rubswap.RData')
rub3m = rubmrtk[, c('USD.RUB', 'swap3m_perc', 'iv3m')]
load('rubswap.RData')
rub3m = rubmrtk[, c('USD.RUB', 'swap3m_perc', 'iv3m')]
names(rub3m) = c('rub', 'swap', 'iv')
rub3m$iv = rub3m$iv/100
View(rub3m)
rub3m$call = (as.data.frame(rub3m) %>% mutate(call = GBSOption('c', rub, rub, 90/365, swap, 0, iv)@price))[, c('call')]
local({
callperc = rub3m$call / rub3m$rub
hist(callperc, breaks=30)
summary(callperc)
})
local({
callperc = rub3m$call / rub3m$rub
hist(callperc, breaks=30, main = 'Call/Usd distribution')
summary(callperc)
})
local({
callperc = rub3m$call / rub3m$rub
hist(callperc, breaks=30, main = 'Call/Usd distribution')
mean(callperc)
})
local({
callperc = rub3m$call / rub3m$rub
hist(callperc, breaks=30, main = 'Call/Usd distribution')
cat('Average call price: ', mean(callperc))
})
local({
callperc = rub3m$call / rub3m$rub
hist(callperc, breaks=30, main = 'Call/Usd distribution')
cat('Average call price: ', format(mean(callperc), digits = 4)
})
local({
callperc = rub3m$call / rub3m$rub
hist(callperc, breaks=30, main = 'Call/Usd distribution')
cat('Average call price: ', format(mean(callperc), digits = 4))
})
require(scales)
local({
callperc = rub3m$call / rub3m$rub
hist(callperc, breaks=30, main = 'Call/Usd distribution')
cat('Average call price: ', percent(mean(callperc)))
})
local({
usd_diff = -lag(diff(rub3m$rub, 90*5/7), k=-90*5/7) / rub3m$rub
autoplot(usd_diff)
hist(usd_diff)
cat('Average 90-days USD price change: ', percent(mean(usd_diff)))
})
-lag(diff(rub3m$rub, 90*5/7), k=-90*5/7) / rub3m$rub
local({
usd_diff = -lag(diff(rub3m$rub, 90*5/7), k=-90*5/7) / rub3m$rub
autoplot(usd_diff)
#hist(usd_diff, breaks=30)
cat('Average 90-days USD price change: ', percent(mean(usd_diff, na.rm = T)))
})
-lag(diff(rub3m$rub, 90*5/7), k=-90*5/7) / rub3m$rub %>% na.omit
-lag(diff(rub3m$rub, 90*5/7), k=-90*5/7) / rub3m$rub %>% na.omit
usd_diff = -lag(diff(rub3m$rub, 90*5/7), k=-90*5/7) / rub3m$rub %>% na.omit
autoplot(usd_diff)
mean(usd_diff, na.rm = T)
rm(usd_diff)
local({
usd_diff <- -lag(diff(rub3m$rub, 90*5/7), k=-90*5/7) / rub3m$rub %>% na.omit
autoplot(usd_diff)
#hist(usd_diff, breaks=30)
cat('Average 90-days USD price change: ', percent(mean(usd_diff, na.rm = T)))
})
usd_diff <- -lag(diff(rub3m$rub, 90*5/7), k=-90*5/7) / rub3m$rub %>% na.omit
View(usd_diff)
tail(usd_diff)
mean(usd_diff, na.rm = T)
percent(mean(usd_diff, na.rm = T))
percent(-mean(usd_diff, na.rm = T))
local({
usd_diff <- -lag(diff(rub3m$rub, 90*5/7), k=-90*5/7) / rub3m$rub %>% na.omit
autoplot(usd_diff)
#hist(usd_diff, breaks=30)
cat('Average 90-days USD price change: ', format(mean(usd_diff, na.rm = T), digits=4))
})
local({
usd_diff <- -lag(diff(rub3m$rub, 90*5/7), k=-90*5/7) / rub3m$rub %>% na.omit
autoplot(usd_diff)
#hist(usd_diff, breaks=30)
cat('Average 90-days USD price change: ', format(mean(usd_diff, na.rm = T), digits=4))
})
usd_diff <- -lag(diff(rub3m$rub, 90*5/7), k=-90*5/7) / rub3m$rub %>% na.omit
autoplot(usd_diff)
cat('Average 90-days USD price change: ', format(mean(usd_diff, na.rm = T), digits=4))
usd_diff[usd_diff>0,]
callperc = rub3m$call / rub3m$rub
usd_diff[usd_diff>0,] / callperc
usd_diff[usd_diff>0,] - callperc
call_profit = usd_diff[usd_diff>0,] - callperc
autoplot(call_profit)
autoplot(call_profit, type='a')
autoplot(call_profit, type='area')
autoplot(call_profit, geom='area')
autoplot(call_profit, geom='point')
autoplot(call_profit, geom='bar')
autoplot(call_profit, geom='histogram')
usd_diff %>% which(.<0)
usd_diff %>% which(<0)
usd_diff %>% which(.<0)
usd_diff %>% which(usd_diff<0)
usd_diff %>% .[<0,]
usd_diff %>% .[.<0,]
usd_diff %>% .[.<0,] %>% .=0
usd_diff %>% .[.>0,]
c(usd_diff %>% .[.<0,] %>% .=0, usd_diff %>% .[.>0,])
usd_diff[usd_diff<0, ]
c(usd_diff[usd_diff<0, ]=0, usd_diff %>% .[.>0,])
c( usd_diff[usd_diff<0, ]=0,  usd_diff[usd_diff>0])
usd_up = usd_diff; usd_up[usd_up<0, ]=0
plot(usd_up)
call_profit = (usd_up - callperc) / rub3m$rub
autoplot(call_profit, geom='histogram')
autoplot(call_profit, geom='area')
call_profit
autoplot(call_profit)
call_profit = (usd_up / callperc)
autoplot(call_profit)
call_profit = (usd_up / call)
call_profit = (usd_up / rub3m$call)
autoplot(call_profit)
usd_up
rub3m$call
usd_diff
(usd_up / callperc)
call_profit = (usd_up / callperc)
autoplot(call_profit)
call_profit[!=0,]
call_profit[call_profit!=0,]
mean(call_profit[call_profit!=0,])
mean(call_profit)
mean(na.omit(call_profit))
mean(call_profit[call_profit>0,])
call_result = usd_diff / callperc
plot(call_result)
usd_diff = -lag(diff(rub3m$rub, 90*5/7), k=-90*5/7)
usd_roc = usd_diff /  rub3m$rub %>% na.omit
autoplot(usd_roc)
cat('Average 90-days USD price change: ', format(mean(usd_roc, na.rm = T), digits=4))
usd_up = usd_diff; usd_up[usd_up<0, ]=0
call_result = (usd_up - rub3m$call) / rub3m$rub
plot(call_result)
cat('Average buy-call strategy result: ', format(mean(call_result, na.rm = T), digits=4))
c(mean(call_result, na.rm = T), mean(call_result['2010/2013'], na.rm = T), mean(call_result['2014'], na.rm = T))
data.frame(
Period = c('All', '2010 - 2013', '2014+'),
Result = c(mean(call_result, na.rm = T), mean(call_result['2010/2013'], na.rm = T), mean(call_result['2014'], na.rm = T))
)
data.frame(
Period = c('All', '2010 - 2013', '2014+'),
Result = c(mean(call_result, na.rm = T), mean(call_result['2010/2013']), mean(call_result['2014'], na.rm = T))
)
data.frame(
Period = c('All', '2010 - 2013', '2014+'),
Result = c(mean(call_result, na.rm = T), mean(call_result['2010/2013']), mean(call_result['2014']))
)
plot(call_result['2014'])
plot(call_result['2014/2015'])
plot(usd_roc['2014'])
usd_diff = lag(diff(rub3m$rub, 90*5/7), k=-90*5/7)
usd_roc = usd_diff /  rub3m$rub %>% na.omit
cat('Average 90-days USD price change: ', format(mean(usd_roc, na.rm = T), digits=4))
usd_up = usd_diff; usd_up[usd_up<0, ]=0
call_result = (usd_up - rub3m$call) / rub3m$rub
data.frame(
Period = c('All', '2010 - 2013', '2014+'),
Result = c(mean(call_result, na.rm = T), mean(call_result['2010/2013']), mean(call_result['2014']))
)
plot(call_result['2014/2015'])
mean(call_result[call_result>0,])
mean(na.omit(call_result))
data.frame(
Period = c('All', '2010 - 2013', '2014+'),
Result = format(c(mean(call_result, na.rm = T),
mean(call_result['2010/2013']),
mean(call_result['2014'])
), digits=4)
)
call_result = (usd_up - rub3m$call) / rub3m$rub
data.frame(
Period = c('All', '2010 - 2013', '2014+'),
Result = format(c(mean(call_result, na.rm = T),
mean(call_result['2010/2013']),
mean(call_result['2014'])
), digits=2)
)
usd_down = usd_diff; usd_down[usd_down>0, ]=0
plot(-usd_down - rub3m$call)
mean(-usd_down - rub3m$call)
mean(-usd_down - rub3m$call, na.rm = T)
mean((-usd_down - rub3m$call)/rub3m$rub, na.rm = T)
cumall(call_result)
View(call_result)
cumall(call_result$rub)
cummean(call_result$rub)
plot(cummean(call_result$rub))
plot(cummean(usd_diff/rub3m$rub))
mean((-usd_down - rub3m$call)/rub3m$rub, na.rm = T)
mean((-usd_diff[usd_diff<0, ] - rub3m$call)/rub3m$rub, na.rm = T)
mean(-usd_diff[usd_diff<0, ])
mean(-usd_diff[usd_diff<0, ]/rub3m$rub)
plot(cumsum(call_result$rub))
plot(cumsum(usd_diff/rub3m$rub))
plot(cumsum(call_result$rub))
autoplot(
merge(cumsum(call_result$rub), cumsum(usd_diff/rub3m$rub)), facets=NULL
)
autoplot(
merge(cumsum(call_result), cumsum(usd_diff/rub3m$rub)), facets=NULL
)
autoplot(
merge(call_result, usd_diff/rub3m$rub), facets=NULL
)
autoplot(
merge(call_result, -usd_diff/rub3m$rub), facets=NULL
)
call_result -usd_diff/rub3m$rub, facets=NULL
autoplot(
call_result-usd_diff/rub3m$rub, facets=NULL
)
mean(call_result-usd_diff/rub3m$rub)
mean(call_result-usd_diff/rub3m$rub, na.rm=T)
autoplot(
call_result-usd_diff/rub3m$rub, facets=NULL
)
autoplot(
merge(call_result, usd_diff/rub3m$rub), facets=NULL
)
autoplot(
merge(call_result, -usd_diff/rub3m$rub), facets=NULL
)
mean(call_result-usd_diff/rub3m$rub, na.rm=T)
local({
usd_diff = lag(diff(rub3m$rub, 90*5/7), k=-90*5/7)
usd_roc = usd_diff /  rub3m$rub %>% na.omit
autoplot(usd_roc)
#hist(usd_diff, breaks=30)
cat('Average 90-days USD price change: ', format(mean(usd_roc, na.rm = T), digits=4))
})
usd_up = usd_diff; usd_up[usd_up<0, ]=0
call_result = (usd_up - rub3m$call) / rub3m$rub
data.frame(
Period = c('All', '2010 - 2013', '2014+'),
Result = format(c(mean(call_result, na.rm = T),
mean(call_result['2010/2013']),
mean(call_result['2014'])
), digits=2)
)
