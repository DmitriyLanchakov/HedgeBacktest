legend.position=c(0,0),
legend.justification = c(0,0)) +
labs(title = 'Валютные риски' , x=NULL, y=NULL)
grid.arrange(chart1, chart2, nrow=2, heights=c(1, 1))
chart2
ggplot() +  theme_grey(base_size = 18) +
geom_area(data=fortify(final_res[,c('Hedged', 'USD_risk')], melt=T), aes(x=Index, y=Value, fill=Series)) +
scale_fill_manual(
values = c('red', 'black'),
name = 'Валютный риск:',
labels=c('Захеджированный', 'Без хеджрования')) +
scale_y_continuous(labels = percent,
breaks=seq(-1,1,0.2)) +
theme(title = element_text(size=14),
legend.position=c(0,0),
legend.justification = c(0,0)) +
labs(title = 'Валютные риски' , x=NULL, y=NULL)
ggplot() +  theme_grey(base_size = 18) +
geom_area(data=fortify(final_res[,c('Hedged', 'USD_risk')], melt=T), aes(x=Index, y=Value, fill=Series)) +
scale_fill_manual(
values = c('red', 'black'),
name = 'Валютный риск:',
labels=c('Захеджированный', 'Без хеджрования')) +
scale_y_continuous(labels = percent,
breaks=seq(-1,1,0.2)) +
theme(title = element_text(size=14),
legend.position=c(0,0),
legend.justification = c(0,0)) +
labs(title = 'Валютные риски' , x=NULL, y=NULL) +
geom_segment(
aes(x=as.Date('2014-01-01'), y=-0.4, xend=as.Date('2014-06-01'), yend=-0.5),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed'))
ggplot() +  theme_grey(base_size = 18) +
geom_area(data=fortify(final_res[,c('Hedged', 'USD_risk')], melt=T), aes(x=Index, y=Value, fill=Series)) +
scale_fill_manual(
values = c('red', 'black'),
name = 'Валютный риск:',
labels=c('Захеджированный', 'Без хеджрования')) +
scale_y_continuous(labels = percent,
breaks=seq(-1,1,0.2)) +
theme(title = element_text(size=14),
legend.position=c(0,0),
legend.justification = c(0,0)) +
labs(title = 'Валютные риски' , x=NULL, y=NULL) +
geom_segment(
aes(x=as.Date('2014-01-01'), y=-0.4, xend=as.Date('2014-06-01'), yend=-0.5),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
annotate('text', x=as.Date('2013-01-01'), y=-0.4, label='Рост доллара - риск для импортёра, \n поэтому график инвертирован')
ggplot() +  theme_grey(base_size = 18) +
geom_area(data=fortify(final_res[,c('Hedged', 'USD_risk')], melt=T), aes(x=Index, y=Value, fill=Series)) +
scale_fill_manual(
values = c('red', 'black'),
name = 'Валютный риск:',
labels=c('Захеджированный', 'Без хеджрования')) +
scale_y_continuous(labels = percent,
breaks=seq(-1,1,0.2)) +
theme(title = element_text(size=14),
legend.position=c(0,0),
legend.justification = c(0,0)) +
labs(title = 'Валютные риски' , x=NULL, y=NULL) +
geom_segment(
aes(x=as.Date('2014-01-01'), y=-0.4, xend=as.Date('2014-06-01'), yend=-0.5),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
annotate('text', x=as.Date('2013-01-01'), y=-0.4, label='Рост доллара - риск для импортёра') +
geom_segment(
aes(x=as.Date('2011-06-01'), y=0.3, xend=as.Date('2011-01-01'), yend=0.2),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
geom_segment(
aes(x=as.Date('2012-01-01'), y=0.3, xend=as.Date('2012-01-01'), yend=0.2),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed'))
ggplot() +  theme_grey(base_size = 18) +
geom_area(data=fortify(final_res[,c('Hedged', 'USD_risk')], melt=T), aes(x=Index, y=Value, fill=Series)) +
scale_fill_manual(
values = c('red', 'black'),
name = 'Валютный риск:',
labels=c('Захеджированный', 'Без хеджрования')) +
scale_y_continuous(labels = percent,
breaks=seq(-1,1,0.2)) +
theme(title = element_text(size=14),
legend.position=c(0,0),
legend.justification = c(0,0)) +
labs(title = 'Валютные риски' , x=NULL, y=NULL) +
geom_segment(
aes(x=as.Date('2014-01-01'), y=-0.4, xend=as.Date('2014-06-01'), yend=-0.5),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
annotate('text', x=as.Date('2013-01-01'), y=-0.4, label='Рост доллара - риск для импортёра') +
geom_segment(
aes(x=as.Date('2011-06-01'), y=0.3, xend=as.Date('2011-01-01'), yend=0.2),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
geom_segment(
aes(x=as.Date('2012-01-01'), y=0.3, xend=as.Date('2012-01-01'), yend=0.2),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
annotate('text', x=as.Date('2011-06-01'), y=0.3, label='Импортёр выигрывает от укрепления рубля')
ggplot() +  theme_grey(base_size = 18) +
geom_area(data=fortify(final_res[,c('Hedged', 'USD_risk')], melt=T), aes(x=Index, y=Value, fill=Series)) +
scale_fill_manual(
values = c('red', 'black'),
name = 'Валютный риск:',
labels=c('Захеджированный', 'Без хеджрования')) +
scale_y_continuous(labels = percent,
breaks=seq(-1,1,0.2)) +
theme(title = element_text(size=14),
legend.position=c(0,0),
legend.justification = c(0,0)) +
labs(title = 'Валютные риски' , x=NULL, y=NULL) +
geom_segment(
aes(x=as.Date('2014-01-01'), y=-0.4, xend=as.Date('2014-06-01'), yend=-0.5),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
annotate('text', x=as.Date('2013-01-01'), y=-0.4, label='Рост доллара - риск для импортёра') +
geom_segment(
aes(x=as.Date('2011-06-01'), y=0.3, xend=as.Date('2011-01-01'), yend=0.2),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
geom_segment(
aes(x=as.Date('2012-01-01'), y=0.3, xend=as.Date('2012-01-01'), yend=0.2),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
annotate('text', x=as.Date('2011-06-01'), y=0.35, label='Импортёр выигрывает от укрепления рубля')
ggplot() +  theme_grey(base_size = 18) +
geom_area(data=fortify(final_res[,c('Hedged', 'USD_risk')], melt=T), aes(x=Index, y=Value, fill=Series)) +
scale_fill_manual(
values = c('red', 'black'),
name = 'Валютный риск:',
labels=c('Захеджированный', 'Без хеджрования')) +
scale_y_continuous(labels = percent,
breaks=seq(-1,1,0.2)) +
theme(title = element_text(size=14),
legend.position=c(0,0),
legend.justification = c(0,0)) +
labs(title = 'Валютные риски' , x=NULL, y=NULL) +
geom_segment(
aes(x=as.Date('2014-01-01'), y=-0.4, xend=as.Date('2014-06-01'), yend=-0.5),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
annotate('text', x=as.Date('2013-03-01'), y=-0.35, label='Рост доллара - риск для импортёра') +
geom_segment(
aes(x=as.Date('2011-06-01'), y=0.3, xend=as.Date('2011-01-01'), yend=0.2),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
geom_segment(
aes(x=as.Date('2012-01-01'), y=0.3, xend=as.Date('2012-01-01'), yend=0.2),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
annotate('text', x=as.Date('2011-06-01'), y=0.35, label='Импортёр выигрывает от укрепления рубля')
ggplot() +  theme_grey(base_size = 18) +
geom_area(data=fortify(final_res[,c('Hedged', 'USD_risk')], melt=T), aes(x=Index, y=Value, fill=Series)) +
scale_fill_manual(
values = c('red', 'black'),
name = 'Валютный риск:',
labels=c('Захеджированный', 'Без хеджрования')) +
scale_y_continuous(labels = percent,
breaks=seq(-1,1,0.2)) +
theme(title = element_text(size=14),
legend.position=c(0,0),
legend.justification = c(0,0),
legend.background = element_blank()) +
labs(title = 'Валютные риски' , x=NULL, y=NULL) +
geom_segment(
aes(x=as.Date('2014-01-01'), y=-0.4, xend=as.Date('2014-06-01'), yend=-0.5),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
annotate('text', x=as.Date('2013-03-01'), y=-0.35, label='Рост доллара - риск для импортёра') +
geom_segment(
aes(x=as.Date('2011-06-01'), y=0.3, xend=as.Date('2011-01-01'), yend=0.2),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
geom_segment(
aes(x=as.Date('2012-01-01'), y=0.3, xend=as.Date('2012-01-01'), yend=0.2),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
annotate('text', x=as.Date('2011-06-01'), y=0.35, label='Импортёр выигрывает от укрепления рубля')
full_join(usd_roc_df, call_res_df, by = 'Period') %>% mutate(Hedged_risk = -USD_risk + Call_result)
aver_hedge_res = full_join(usd_roc_df, call_res_df, by = 'Period') %>% mutate(Hedged_risk = -USD_risk + Call_result)
tableGrob(aver_hedge_res)
grid.arrange(tableGrob(aver_hedge_res))
foreach( i=2:4) %do%{
aver_hedge_res[, i] = paste(round(aver_hedge_res[, i]  * 100, digits = 2), '%', sep='')
}
aver_hedge_res
usd_roc_df =data.frame(
Period = c('All', '2010 - 2013', '2014+'),
USD_risk = c(mean(-usd_roc, na.rm = T),
mean(-usd_roc['2010/2013'], na.rm = T),
mean(-usd_roc['2014/2015'], na.rm = T)
)
)
aver_hedge_res = full_join(usd_roc_df, call_res_df, by = 'Period') %>% mutate(Hedged_risk = -USD_risk + Call_result)
foreach( i=2:4) %do%{
aver_hedge_res[, i] = paste(round(aver_hedge_res[, i]  * 100, digits = 2), '%', sep='')
}
aver_hedge_res
aver_hedge_res = full_join(usd_roc_df, call_res_df, by = 'Period') %>% mutate(Hedged_risk = USD_risk + Call_result)
foreach( i=2:4) %do%{
aver_hedge_res[, i] = paste(round(aver_hedge_res[, i]  * 100, digits = 2), '%', sep='')
}
grid.arrange(tableGrob(aver_hedge_res))
names(aver_hedge_res) = c('Период', 'Валютный риск', 'Результат опциона', 'Хеджированный риск')
grid.arrange(tableGrob(aver_hedge_res))
grid.arrange(tableGrob(aver_hedge_res), name='test')
grid.draw(tableGrob(aver_hedge_res), name='test')
grid.draw(tableGrob(aver_hedge_res, name='test'))
res_grob = tableGrob(aver_hedge_res, name='test')
grid.arrange(chart2, res_grob, nrow=2, heights=c(1, 1))
grid.arrange(chart2, res_grob, ncol=2, widths=c(1, 1))
grid.arrange(chart2, res_grob, nrow=2, heights=c(1, 1))
grid.arrange(chart2, res_grob, nrow=2, heights=c(1, 0.5))
chart2 = ggplot() +  theme_grey(base_size = 18) +
geom_area(data=fortify(final_res[,c('Hedged', 'USD_risk')], melt=T), aes(x=Index, y=Value, fill=Series)) +
scale_fill_manual(
values = c('red', 'black'),
name = 'Валютный риск:',
labels=c('Захеджированный', 'Без хеджрования')) +
scale_y_continuous(labels = percent,
breaks=seq(-1,1,0.2)) +
theme(title = element_text(size=14),
legend.position=c(0,0),
legend.justification = c(0,0),
legend.background = element_blank()) +
labs(title = 'Валютные риски импортёра' , x=NULL, y=NULL) +
geom_segment(
aes(x=as.Date('2014-01-01'), y=-0.4, xend=as.Date('2014-06-01'), yend=-0.5),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
annotate('text', x=as.Date('2013-03-01'), y=-0.35, label='Рост доллара - риск для импортёра') +
geom_segment(
aes(x=as.Date('2011-06-01'), y=0.3, xend=as.Date('2011-01-01'), yend=0.2),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
geom_segment(
aes(x=as.Date('2012-01-01'), y=0.3, xend=as.Date('2012-01-01'), yend=0.2),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
annotate('text', x=as.Date('2011-06-01'), y=0.35, label='Импортёр выигрывает от укрепления рубля')
grid.arrange(chart2, res_grob, nrow=2, heights=c(1, 0.5))
usd_down = usd_diff
usd_down[usd_down>0, ]=0
put_result = (usd_down - rub3m$put) / rub3m$rub
rub3m$put
rub3m$put  = (as.data.frame(rub3m) %>% mutate(put = GBSOption('p', rub, rub, 90/365, swap, 0, iv)@price))[, c('put')
]
put_result = (usd_down - rub3m$put) / rub3m$rub
autoplot(put_result)
put_result = (-usd_down - rub3m$put) / rub3m$rub
autoplot(put_result)
xxx = local({2+2})
xxx = local({2+2; 3+3})
local({
# Средний прирост доллара за 90 дней:
usd_roc_df =data.frame(
Period = c('All', '2010 - 2013', '2014+'),
USD_risk = c(mean(usd_roc, na.rm = T),
mean(usd_roc['2010/2013'], na.rm = T),
mean(usd_roc['2014/2015'], na.rm = T)) )
# Средний результа по коллу за 90 дней:
put_res_df = data.frame(
Period = c('All', '2010 - 2013', '2014+'),
Put_result = c(mean(put_result, na.rm = T),
mean(put_result['2010/2013']),
mean(put_result['2014'])))
aver_hedge_res = full_join(usd_roc_df, put_res_df, by = 'Period') %>% mutate(Hedged_risk = USD_risk + Put_result)
aver_hedge_res
})
hedge_res = local({
# Средний прирост доллара за 90 дней:
usd_roc_df =data.frame(
Period = c('All', '2010 - 2013', '2014+'),
USD_risk = c(mean(usd_roc, na.rm = T),
mean(usd_roc['2010/2013'], na.rm = T),
mean(usd_roc['2014/2015'], na.rm = T)) )
# Средний результа по коллу за 90 дней:
put_res_df = data.frame(
Period = c('All', '2010 - 2013', '2014+'),
Put_result = c(mean(put_result, na.rm = T),
mean(put_result['2010/2013']),
mean(put_result['2014'])))
aver_hedge_res = full_join(usd_roc_df, put_res_df, by = 'Period') %>% mutate(Hedged_risk = USD_risk + Put_result)
foreach( i=2:4) %do% {
aver_hedge_res[, i] = paste(round(aver_hedge_res[, i]  * 100, digits = 2), '%', sep='')
}
names(aver_hedge_res) = c('Период', 'Валютный риск', 'Результат опциона', 'Хеджированный риск')
aver_hedge_res
})
tableGrob(hedge_res, name='test')
tableGrob(hedge_res, name='test')
grid.draw(tableGrob(hedge_res, name='test'))
ggplot() +  theme_grey(base_size = 18) +
geom_area(data=fortify(final_res_put[,c('Hedged', 'USD_risk')], melt=T), aes(x=Index, y=Value, fill=Series))
final_res_put =  merge(merge(put_result, usd_diff/rub3m$rub), put_result+usd_diff/rub3m$rub) %>% na.omit
names(final_res_put) = c('Put_Profit', 'USD_risk', 'Hedged')
ggplot() +  theme_grey(base_size = 18) +
geom_area(data=fortify(final_res_put[,c('Hedged', 'USD_risk')], melt=T), aes(x=Index, y=Value, fill=Series))
ggplot() +  theme_grey(base_size = 18) +
geom_area(data=fortify(final_res_put[,c('Hedged', 'USD_risk')], melt=T), aes(x=Index, y=Value, fill=Series)) +
scale_fill_manual(
values = c('red', 'black'),
name = 'Валютный риск:',
labels=c('Захеджированный', 'Без хеджрования')) +
scale_y_continuous(labels = percent,
breaks=seq(-1,1,0.2)) +
theme(title = element_text(size=14),
legend.position=c(0,0),
legend.justification = c(0,0),
legend.background = element_blank()) +
labs(title = 'Валютные риски экспортёра' , x=NULL, y=NULL)
ggplot() +  theme_grey(base_size = 18) +
geom_area(data=fortify(final_res_put[,c('Hedged', 'USD_risk')], melt=T), aes(x=Index, y=Value, fill=Series)) +
scale_fill_manual(
values = c('red', 'black'),
name = 'Валютный риск:',
labels=c('Захеджированный', 'Без хеджрования')) +
scale_y_continuous(labels = percent,
breaks=seq(-1,2,0.2)) +
theme(title = element_text(size=14),
legend.position=c(0,1),
legend.justification = c(0,0),
legend.background = element_blank()) +
labs(title = 'Валютные риски экспортёра' , x=NULL, y=NULL)
ggplot() +  theme_grey(base_size = 18) +
geom_area(data=fortify(final_res_put[,c('Hedged', 'USD_risk')], melt=T), aes(x=Index, y=Value, fill=Series)) +
scale_fill_manual(
values = c('red', 'black'),
name = 'Валютный риск:',
labels=c('Захеджированный', 'Без хеджрования')) +
scale_y_continuous(labels = percent,
breaks=seq(-1,2,0.2)) +
theme(title = element_text(size=14),
legend.position=c(0,1),
legend.justification = c(0,-1),
legend.background = element_blank()) +
labs(title = 'Валютные риски экспортёра' , x=NULL, y=NULL
)
ggplot() +  theme_grey(base_size = 18) +
geom_area(data=fortify(final_res_put[,c('Hedged', 'USD_risk')], melt=T), aes(x=Index, y=Value, fill=Series)) +
scale_fill_manual(
values = c('red', 'black'),
name = 'Валютный риск:',
labels=c('Захеджированный', 'Без хеджрования')) +
scale_y_continuous(labels = percent,
breaks=seq(-1,2,0.2)) +
theme(title = element_text(size=14),
legend.position=c(0,1),
legend.justification = c(0,0),
legend.background = element_blank()) +
labs(title = 'Валютные риски экспортёра' , x=NULL, y=NULL)
ggplot() +  theme_grey(base_size = 18) +
geom_area(data=fortify(final_res_put[,c('Hedged', 'USD_risk')], melt=T), aes(x=Index, y=Value, fill=Series)) +
scale_fill_manual(
values = c('red', 'black'),
name = 'Валютный риск:',
labels=c('Захеджированный', 'Без хеджрования')) +
scale_y_continuous(labels = percent,
breaks=seq(-1,2,0.2)) +
theme(title = element_text(size=14),
legend.position=c(0,1),
legend.justification = c(0,1),
legend.background = element_blank()) +
labs(title = 'Валютные риски экспортёра' , x=NULL, y=NULL)
chart3 = ggplot() +  theme_grey(base_size = 18) +
geom_area(data=fortify(final_res_put[,c('Hedged', 'USD_risk')], melt=T), aes(x=Index, y=Value, fill=Series)) +
scale_fill_manual(
values = c('red', 'black'),
name = 'Валютный риск:',
labels=c('Захеджированный', 'Без хеджрования')) +
scale_y_continuous(labels = percent,
breaks=seq(-1,2,0.2)) +
theme(title = element_text(size=14),
legend.position=c(0,1),
legend.justification = c(0,1),
legend.background = element_blank()) +
labs(title = 'Валютные риски экспортёра' , x=NULL, y=NULL)
grid.arrange(chart3, res_grob_зге, nrow=2, heights=c(1, 0.5))
grid.arrange(chart3, res_grob_put, nrow=2, heights=c(1, 0.5))
res_grob_put = tableGrob(hedge_res, name='test')
grid.arrange(chart3, res_grob_put, nrow=2, heights=c(1, 0.5))
local(sd(ROC(final_res_put$Hedged)))
local({sd(ROC(final_res_put$Hedged))})
sd(ROC(final_res_put$Hedged))
(ROC(final_res_put$Hedged)
)
final_res_put$Hedged
sd(ROC(final_res_put$Hedged, type = 'discrete'))
ROC(final_res_put$Hedged, type = 'discrete')
sd(ROC(final_res_put$Hedged, type = 'discrete'), na.rm=T)
var(ROC(final_res_put$Hedged, type = 'discrete'), na.rm=T)
sd(ROC(final_res_put$Hedged, type = 'discrete'), na.rm=T)
autoplot(ROC(final_res_put$Hedged, type = 'discrete'))
autoplot((final_res_put$Hedged))
sd(final_res_put$Hedged), na.rm=T)
sd((final_res_put$Hedged), na.rm=T)
sd(final_res_put$USD_risk, na.rm = T)
mean(final_res_put$Hedged, na.rm=T)/sd(final_res_put$Hedged, na.rm=T)
mean(final_res_put$USD_risk, na.rm=T)/sd(final_res_put$USD_risk, na.rm = T)
grid.arrange(chart2, res_grob, nrow=2, heights=c(1, 0.5))
chart2 = ggplot() +  theme_grey(base_size = 18) +
geom_area(data=fortify(final_res[,c('Hedged', 'USD_risk')], melt=T), aes(x=Index, y=Value, fill=Series)) +
scale_fill_manual(
values = c('red', 'black'),
name = 'Валютный риск:',
labels=c('Захеджированный', 'Без хеджрования')) +
scale_y_continuous(labels = percent,
breaks=seq(-1,1,0.2)) +
theme(title = element_text(size=14),
legend.position=c(0,0),
legend.justification = c(0,0),
legend.background = element_blank()) +
labs(title = 'Валютные риски импортёра' , x=NULL, y=NULL) +
geom_segment(
aes(x=as.Date('2014-01-01'), y=-0.4, xend=as.Date('2014-06-01'), yend=-0.5),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
annotate('text', x=as.Date('2013-03-01'), y=-0.35, label='Рост доллара - риск для импортёра') +
geom_segment(
aes(x=as.Date('2011-06-01'), y=0.3, xend=as.Date('2011-01-01'), yend=0.2),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
geom_segment(
aes(x=as.Date('2012-01-01'), y=0.3, xend=as.Date('2012-01-01'), yend=0.2),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
geom_segment(
aes(x=as.Date('2012-06-01'), y=0.3, xend=as.Date('2015-01-01'), yend=0.2),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
annotate('text', x=as.Date('2011-06-01'), y=0.35, label='Импортёр выигрывает от укрепления рубля')
grid.arrange(chart2, res_grob, nrow=2, heights=c(1, 0.5))
chart2 = ggplot() +  theme_grey(base_size = 18) +
geom_area(data=fortify(final_res[,c('Hedged', 'USD_risk')], melt=T), aes(x=Index, y=Value, fill=Series)) +
scale_fill_manual(
values = c('red', 'black'),
name = 'Валютный риск:',
labels=c('Захеджированный', 'Без хеджрования')) +
scale_y_continuous(labels = percent,
breaks=seq(-1,1,0.2)) +
theme(title = element_text(size=14),
legend.position=c(0,0),
legend.justification = c(0,0),
legend.background = element_blank()) +
labs(title = 'Валютные риски импортёра' , x=NULL, y=NULL) +
geom_segment(
aes(x=as.Date('2014-01-01'), y=-0.4, xend=as.Date('2014-06-01'), yend=-0.5),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
annotate('text', x=as.Date('2013-03-01'), y=-0.35, label='Рост доллара - риск для импортёра') +
geom_segment(
aes(x=as.Date('2011-06-01'), y=0.3, xend=as.Date('2011-01-01'), yend=0.2),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
geom_segment(
aes(x=as.Date('2012-01-01'), y=0.3, xend=as.Date('2012-01-01'), yend=0.2),
arrow = arrow(length = unit(0.2, 'cm'), type = 'closed')) +
annotate('text', x=as.Date('2011-06-01'), y=0.35, label='Импортёр выигрывает от укрепления рубля')
grid.arrange(chart2, res_grob, nrow=2, heights=c(1, 0.5))
require(fOptions)
require(xts)
require(dplyr)
require(ggplot2)
require(scales)
require(grid)
require(gridExtra)
require(foreach)
require(TTR)
require(ggvis)
require(tidyr)
as.data.frame(rub3m) %>% filter(last(iv))
as.data.frame(rub3m) %>% last(iv)
as.data.frame(rub3m) %>% n(iv)
as.data.frame(rub3m) %>% n()
as.data.frame(rub3m) %>% n
as.data.frame(rub3m) %>% last
as.data.frame(rub3m) %>% last(order_by(date))
as.data.frame(rub3m) %>% last()
as.data.frame(rub3m)
as.data.frame(rub3m) %>% last(iv)
as.data.frame(rub3m) %>% last(.$iv)
as.data.frame(rub3m) %>% last(., iv)
as.data.frame(rub3m) %>% n()
as.data.frame(rub3m) %>% filter(row_number()==n())
calls = rub3m %>%
as.data.frame %>%
mutate(call = GBSOption('c', rub, rub*(1+otm), days/365, 0, swap, iv)@price) %>%
mutate(pl = call/call[1]-1)
days = 90
otm = 0
target = 5
load('rub.RData')
rub3m = rub[, c('rub', 'swap1y', 'iv1y')]
names(rub3m) = c('rub', 'swap', 'iv')
calls = rub3m %>%
as.data.frame %>%
mutate(call = GBSOption('c', rub, rub*(1+otm), days/365, 0, swap, iv)@price) %>%
mutate(pl = call/call[1]-1)
calls
install.packages(c("rmarkdown", "tidyr"))
require(fOptions)
require(xts)
require(dplyr)
require(ggplot2)
require(scales)
require(grid)
require(gridExtra)
require(foreach)
require(TTR)
require(ggvis)
require(tidyr)
calls = rub3m %>%
as.data.frame %>%
mutate(call = GBSOption('c', rub, rub*(1+otm), days/365, 0, swap, iv)@price) %>%
mutate(pl = call/call[1]-1)
calls
calls = rub3m %>%
as.data.frame %>% as.tbl %>%
mutate(call = GBSOption('c', rub, rub*(1+otm), days/365, 0, swap, iv)@price) %>%
mutate(pl = call/call[1]-1)
calls
calls %>% mutate(rub - n(rub))
calls %>% mutate(rub - n())
calls %>% mutate(rub - last())
calls %>% mutate(rub - last(rub))
calls %>% mutate(rub - first(rub))
View(rub3m)
rub3m %>% filter(iv>0.1)
as.data.frame(rub3m)
as.data.frame(rub3m) %>% filter(iv>0.1)
as.data.frame(rub3m) %>% filter(row.names()>'2011-01-01')
as.data.frame(rub3m) %>% filter(row.names(.)>'2011-01-01')
as.data.frame(rub3m) %>% filter(row.names(.)>'2014-01-01')
data_window = as.data.frame(rub3m) %>% filter(row.names(.)>'2014-01-01')
data_window
View(data_window)
